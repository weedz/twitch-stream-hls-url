<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        html,
        body,
        input,
        button,
        textarea {
            font-family: monospace;
            color: #ccc;
        }
        html, body {
            background: #121212;
            font-size: 16px;
        }

        button,
        input {
            padding: 5px 11px;
            background: #222;
            border: 1px solid #777;
            border-radius: 2px;
        }
        button:not(:disabled):hover {
            background: #2c2c2c;
        }
        input:focus,
        button:focus {
            outline: solid 1px rgb(228, 0, 120);
        }

        button:disabled,
        input:disabled {
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <form id="form" method="POST" action="/twitch">
        <label>
            <p>Channel name:</p>
            <input tabindex="1" autofocus type="text" name="channel">
        </label>
        <button class="submit-btn" type="submit">Cast</button>
    </form>
    <p id="info"></p>
    <script>
        const form = document.getElementById("form");
        const submitBtn = form.querySelector(".submit-btn");
        const infoSection = document.getElementById("info");

        let clearInfoTimeout;

        form.addEventListener("submit", async e => {
            e.preventDefault();

            window.clearTimeout(clearInfoTimeout);

            const channel = e.currentTarget.channel.value;
            if (!channel) {
                return;
            }

            infoSection.textContent = `Casting channel "${channel}" to fcast reciever...`;

            submitBtn.disabled = true;
            clearInfoTimeout = window.setTimeout(() => {
                submitBtn.disabled = false;
                infoSection.textContent = "";
            }, 5000);

            const body = { channel };
            const response = await fetch("/twitch", {
                method: "POST",
                body: JSON.stringify(body),
                headers: {
                    "content-type": "application/json",
                }
            });
            console.log("Response status:", response.ok, response.status);
            if (!response.ok) {
                infoSection.textContent = `Request failed. Status code: ${response.status} ${response.statusText}`;
            }
        });
    </script>
</body>
</html>
